###Module
id df_sphere
component df_sphere
flags {lib, distance}
par {diam: 1.0, tex_sc: wave 0.044 0.1 0.45}
modules {cam_trans: trans1}

###Component
id df_sphere
family distance_field
default_mod df_sphere
children {cam_trans: cam_trans}
code &&&

%cam_trans%

float l = length(pos) - |diam|;

vec3 sc = pos / vec3(|tex_sc|, |tex_sc|, |tex_sc|);
vec2 ofs = sc.xy;
ofs = (ofs + vec2(1.0, 1.0)) / vec2(2.0, 2.0);

df = vec3(ofs, l);
pos = pos_orig;


###Module
id df_cylinder
component df_cylinder
flags {lib, distance}
par {diam: 0.5, tex_sc: wave 0.044 0.1 0.45}
modules {cam_trans: trans_y}

###Component
id df_cylinder
family distance_field
default_mod df_cylinder
children {cam_trans: cam_trans}
code &&&

%cam_trans%

float l = length(pos.xz) - |diam|;

vec3 sc = pos / vec3(|tex_sc|, |tex_sc|, |tex_sc|);
vec2 ofs;
ofs = vec2(atan(sc.x, sc.z) / PI, -1.0 * sc.y / (2.0 * PI * |diam|));
ofs = (ofs + vec2(1.0, 1.0)) / vec2(2.0, 2.0);

df = vec3(ofs, l);


###Module
id df_cube
component df_cube
flags {lib, distance}
par {diam: 0.5, tex_sc: 1.0}
modules {cam_trans: trans2}

###Component
id df_cube
family distance_field
default_mod df_cube
children {cam_trans: cam_trans}
code &&&

%cam_trans%

vec3 d  = abs(pos) - vec3(|diam|, |diam|, |diam|);
float l = min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));

vec3 sc = pos / vec3(|tex_sc| * |diam|, |tex_sc| * |diam|, |tex_sc| * |diam|);
vec2 ofs;

// optomize?
if(abs(sc.z) > sc.x && abs(sc.z) > -1.0 * sc.x &&
   abs(sc.z) > sc.y && abs(sc.z) > -1.0 * sc.y){
  ofs = sc.xy;
}else if(abs(sc.x) > sc.y && abs(sc.x) > -1.0 * sc.y &&
   abs(sc.x) > sc.z && abs(sc.x) > -1.0 * sc.z){
  ofs = sc.yz;
}else
  ofs = sc.zx;

ofs = (ofs + vec2(1.0, 1.0)) / vec2(2.0, 2.0);

df = vec3(ofs, l);


###Module
id df_torus
component df_torus
flags {lib, distance}
par {diam1: 0.7, diam2: 0.2, tex_sc: wave 0.044 0.1 0.45}
modules {cam_trans: trans2}

###Component
id df_torus
family distance_field
default_mod df_torus
children {cam_trans: cam_trans}
code &&&

%cam_trans%

vec2 q = vec2(length(pos.xy) - |diam1|, pos.z);
float l = length(q) - |diam2|;

// TODO: finish me
vec2 ofs;
ofs = vec2(atan(q.x / |tex_sc|, q.y / |tex_sc|) / PI,
           atan(pos.x / |tex_sc|, pos.y / |tex_sc|) / (2.0 * PI * |diam2|));
ofs = (ofs + vec2(1.0, 1.0)) / vec2(2.0, 2.0);

df = vec3(ofs, l);
